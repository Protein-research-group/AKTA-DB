{% extends "template.html" %}

{% block script_code %}

{% endblock %}

{% block left_panel %}
    {% for sample in sample_list %}
        <div class="bg-blue-100 p-4 rounded-lg">
            <img src="{{sample.image_path}}" >
            <p class="text-sm font-medium">File: {{sample.name}}</p>
            <p class="text-sm">Type: {{sample.file_type}}</p>
        </div>
    {% endfor %}

    {{ super() }}
{% endblock %}

{% block middle_panel %}
    {{akta_fig | safe}}
    </br>
    <p>if y not equal UV 280nm, please hide fraction/phase annotation.(not work autoscale)</p>
{% endblock %}

{% block right_panel %}
<div class="col-span-3 bg-blue-50 p-4 rounded-lg">
    <h2 class="font-semibold mb-4">Fraction pooling</h2>
    <div>
      <div>
        <h3 class="text-xs font-medium mb-2">Select fractions</h3>
        <input type="text" placeholder="fraction name" id="fractionInput" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-xs">
        <ul id="suggestions" class="absolute z-10 w-full bg-white border border-gray-300 rounded-md mt-1 hidden"></ul>                
    </div>

      <div id="fractionButtons" class="flex flex-wrap gap-2">
      </div>

      <h3 class="text-xs font-medium mb-2">New name</h3>
      <button class="w-full bg-blue-500 text-white py-2 px-4 rounded-lg text-xs hover:bg-blue-600 transition duration-300">pooling</button>
    </div>
  </div>

  <script type="module">
    // ... (Existing chart code remains unchanged) ...
    console.log('START');
    let fractionList = {{fraction_list | safe}};
  
    const fractionInput = document.getElementById('fractionInput');
    const suggestions = document.getElementById('suggestions');
    const fractionButtons = document.getElementById('fractionButtons');

    fractionInput.addEventListener('input', function() {
        const inputValue = this.value.toLowerCase();
        const filteredSuggestions = fractionList.filter(item => 
            item.toLowerCase().includes(inputValue)
        );
        
        updateSuggestions(suggestions, filteredSuggestions, fractionInput);
    });
  
    fractionInput.addEventListener('keydown', function(event) {
      if (event.key === 'Enter') {
        const fractionName = fractionInput.value.trim();
  
        if (fractionName !== '') {
          // pre要素を作成
          const preElement = document.createElement('pre');
          preElement.classList.add('bg-gray-200', 'text-gray-700', 'p-2', 'rounded-lg', 'text-xs', 'relative'); // relativeを追加
          preElement.textContent = fractionName;
  
  
          // 閉じるボタンを作成
          const closeButton = document.createElement('span');
          closeButton.classList.add('close-button');
          closeButton.innerHTML = '&times;'; // バツ印
          closeButton.addEventListener('click', () => {
            fractionButtons.removeChild(preElement); // pre要素を削除
          });
  
          preElement.appendChild(closeButton); // pre要素に閉じるボタンを追加
          fractionButtons.appendChild(preElement);
  
          fractionInput.value = ''; // 入力欄をクリア
        }
        event.preventDefault();
      }
    });

    function updateSuggestions(suggestionsElement, items, inputElement) {
    suggestionsElement.innerHTML = '';
    
    if (items.length === 0) {
        suggestionsElement.classList.add('hidden');
        return;
    }

    items.forEach(item => {
        const li = document.createElement('li');
        li.textContent = item;
        li.className = 'px-3 py-1 hover:bg-gray-100 cursor-pointer';
        li.addEventListener('click', () => {
            inputElement.value = item;
            suggestionsElement.classList.add('hidden');
        });
        suggestionsElement.appendChild(li);
    });

    suggestionsElement.classList.remove('hidden');
}
  </script>
{% endblock %}